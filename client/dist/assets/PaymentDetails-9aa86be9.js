import{j as o,b as s,k as T,l as b,m as N,r as d,C as g,U as P,d as O,n as J,c as U}from"./index-d73aedfc.js";import{a as j}from"./axios-707ed124.js";import q from"./DisplayAddress-3a29e11f.js";import{l as E}from"./loading-loop-4f5d220b.js";/* empty css                   */function C(a,e,t){return a.map((r,n)=>o("div",{className:"deliveryAddress",children:[s("input",{type:"radio",name:"deliveryAddress",id:t+n,value:r,onClick:()=>{e(JSON.parse(r))},required:!0}),s("label",{htmlFor:t+n,children:s(q,{data:JSON.parse(r),width:"700px"},n)})]},n))}function F(a){const e=Math.floor(parseInt(a)/1e4);return a?10<=e&&e<=13||40<=e&&e<=44||56<=e&&e<=64?{freeDelivery:!0,DC:0,deliveryTime:{min:3,max:5},deliveryID:T}:70<=e&&e<=85?{freeDelivery:!1,DC:40,deliveryTime:{min:5,max:7},deliveryID:b}:{freeDelivery:!1,DC:50,deliveryTime:{min:9,max:11},deliveryID:N}:{}}const L=(a,e)=>{const t=Math.floor(Math.random()*(e-a));Date.prototype.addDays=function(m){let c=new Date(this.valueOf());return c.setDate(c.getDate()+m),c};const l=new Date;return new Date(l.addDays(a+t)).toISOString()},M="/assets/checkoutImg-404b3d36.png";function Y(){var D,h,p,f;const{price:a}=d.useContext(g),{currentUser:e}=d.useContext(P),[t,l]=d.useState(""),[r,n]=d.useState({}),[m,c]=d.useState(0),[I,v]=d.useState(!1),{cartItems:y,itemsQuantity:w,cartDispatch:_}=d.useContext(g),x=y==null?void 0:y.map(i=>({itemId:i==null?void 0:i._id,quantity:w.get(i==null?void 0:i._id)}));d.useEffect(()=>{document.title="Jayantique| Checkout"},[]);async function S(i){i.preventDefault(),v(!0);try{const u=await j.post(`${U}/checkout`,{data:x,DC:r.deliveryID,discount:m,user:e._id,deliveryAddress:JSON.stringify(t),DeliveryDate:L(r.deliveryTime.min,r.deliveryTime.max)});v(!1),localStorage.setItem("sessionId",u.data.id),window.location.href=u.data.url}catch(u){console.log(u)}}d.useEffect(()=>{e.address&&t&&n(F(t.pincode)),parseInt(a)>25&&c((.1*a*80).toFixed(2))},[t]);const A=e.address&&C(e.address.home,l,"home"),k=e.address&&C(e.address.work,l,"work");return o("div",{className:"checkoutPage",children:[s("img",{src:M,alt:"image",className:"checkoutImg"}),o("form",{className:"paymentDetails",onSubmit:t.pincode&&y.length?S:i=>{i.preventDefault()},children:[o("div",{className:"deliveryAddresses",children:[s("span",{id:"deliveryHeading",children:"Please choose an address to deliver your order"}),e.address&&A,e.address&&k,s(O,{to:"/auth/user",onClick:()=>{sessionStorage.setItem(J,"Addresses"),sessionStorage.setItem("sourcePath",window.location.pathname)},children:s("button",{children:"Add new Address"})})]}),o("div",{className:"deliveryChargeAndTime",style:t.pincode&&y.length?{}:{display:"none"},children:[s("span",{id:"deliveryHeading",children:"Delivery Stats"}),r.deliveryTime&&o("span",{children:["Your order will be delivered between"," ",((D=r.deliveryTime)==null?void 0:D.min)===((h=r.deliveryTime)==null?void 0:h.max)?r.deliveryTime.max:((p=r.deliveryTime)==null?void 0:p.min)+" - "+((f=r.deliveryTime)==null?void 0:f.max)," ","days"]}),r.deliveryTime&&s("span",{children:r.DC?`Delivery charge of ${r.DC} will apply to your order.`:"Free delivery is available to your order"})]}),s("button",{className:"payBtn",children:I?s("img",{src:E}):"Pay"})]})]})}export{Y as default};
